<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Facebook Activity Scrubber Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background-color: #f0f2f5;
      }

      .activity-item {
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 16px;
        margin-bottom: 16px;
        position: relative;
      }

      .more-options {
        position: absolute;
        top: 16px;
        right: 16px;
        background: #f0f2f5;
        border: 1px solid #ccc;
        border-radius: 50%;
        width: 32px;
        height: 32px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .menu {
        position: absolute;
        top: 40px;
        right: 0;
        background: white;
        border: 1px solid #ccc;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        display: none;
        z-index: 1000;
      }

      .menu-item {
        padding: 12px 16px;
        cursor: pointer;
        border-bottom: 1px solid #eee;
      }

      .menu-item:last-child {
        border-bottom: none;
      }

      .menu-item:hover {
        background-color: #f0f2f5;
      }

      .permanent-profile-change::after {
        content: 'Profile changes cannot be removed';
        position: absolute;
        top: -25px;
        left: 50%;
        transform: translateX(-50%);
        background: #ff4444;
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 10px;
        font-weight: 500;
        white-space: nowrap;
        z-index: 10000;
        box-shadow: 0 2px 8px rgba(255, 68, 68, 0.3);
        border: 1px solid #cc0000;
        pointer-events: none;
      }

      .permanent-profile-change {
        position: relative;
      }

      .test-button {
        background: #1877f2;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
        margin: 10px 5px;
      }

      .test-button:hover {
        background: #166fe5;
      }
    </style>
  </head>
  <body>
    <h1>Facebook Activity Scrubber Test</h1>
    <p>
      This page simulates Facebook activity items to test the new "Add to
      profile" edge case handling.
    </p>

    <button class="test-button" onclick="testNormalMenu()">
      Test Normal Menu
    </button>
    <button class="test-button" onclick="testAddToProfileOnly()">
      Test "Add to Profile" Only
    </button>
    <button class="test-button" onclick="clearClasses()">Clear Classes</button>

    <div class="activity-item">
      <h3>Normal Activity Item</h3>
      <p>This is a normal activity item with multiple menu options.</p>
      <div
        class="more-options"
        aria-label="More options"
        onclick="toggleMenu(this)"
      >
        ⋯
      </div>
      <div class="menu">
        <div class="menu-item" role="menuitem">Delete</div>
        <div class="menu-item" role="menuitem">Edit</div>
        <div class="menu-item" role="menuitem">Add to profile</div>
      </div>
    </div>

    <div class="activity-item">
      <h3>Profile-Only Activity Item</h3>
      <p>
        This activity item only has "Add to profile" as an option (edge case).
      </p>
      <div
        class="more-options"
        aria-label="More options"
        onclick="toggleMenu(this)"
      >
        ⋯
      </div>
      <div class="menu">
        <div class="menu-item" role="menuitem">Add to profile</div>
      </div>
    </div>

    <script>
      function toggleMenu(button) {
        const menu = button.nextElementSibling;
        const isVisible = menu.style.display === 'block';

        // Close all menus first
        document
          .querySelectorAll('.menu')
          .forEach((m) => (m.style.display = 'none'));

        if (!isVisible) {
          menu.style.display = 'block';
        }
      }

      function testNormalMenu() {
        const buttons = document.querySelectorAll(
          'div[aria-label="More options"]'
        );
        const normalButton = buttons[0];

        // Simulate clicking the first button (normal menu)
        normalButton.click();
        setTimeout(() => {
          const menuItems = normalButton.nextElementSibling.querySelectorAll(
            'div[role="menuitem"]'
          );
          console.log(
            'Normal menu items:',
            Array.from(menuItems).map((item) => item.textContent)
          );

          // Check if it has multiple options (should not get permanent-profile-change class)
          if (menuItems.length > 1) {
            console.log(
              '✓ Normal menu with multiple options - should not be marked'
            );
          } else {
            console.log('✗ Expected multiple menu items');
          }
        }, 100);
      }

      function testAddToProfileOnly() {
        const buttons = document.querySelectorAll(
          'div[aria-label="More options"]'
        );
        const profileButton = buttons[1];

        // Simulate clicking the second button (profile-only menu)
        profileButton.click();
        setTimeout(() => {
          const menuItems = profileButton.nextElementSibling.querySelectorAll(
            'div[role="menuitem"]'
          );
          console.log(
            'Profile-only menu items:',
            Array.from(menuItems).map((item) => item.textContent)
          );

          // Check if it has only "Add to profile" option
          if (
            menuItems.length === 1 &&
            menuItems[0].textContent.includes('Add to profile')
          ) {
            console.log('✓ Found "Add to profile" only menu - marking button');
            profileButton.classList.add('permanent-profile-change');
            console.log('✓ Button marked with permanent-profile-change class');
          } else {
            console.log('✗ Expected single "Add to profile" menu item');
          }
        }, 100);
      }

      function clearClasses() {
        document.querySelectorAll('.permanent-profile-change').forEach((el) => {
          el.classList.remove('permanent-profile-change');
        });
        console.log('✓ Cleared all permanent-profile-change classes');
      }

      // Close menus when clicking outside
      document.addEventListener('click', function (e) {
        if (!e.target.closest('.more-options') && !e.target.closest('.menu')) {
          document
            .querySelectorAll('.menu')
            .forEach((m) => (m.style.display = 'none'));
        }
      });

      console.log(
        'Test page loaded. Use the buttons above to test the functionality.'
      );
      console.log(
        '1. Click "Test Add to Profile Only" to simulate the edge case'
      );
      console.log(
        '2. The button should get marked with the permanent-profile-change class'
      );
      console.log('3. You should see the red warning message appear');
    </script>
  </body>
</html>
